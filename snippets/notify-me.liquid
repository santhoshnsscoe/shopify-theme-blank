{% doc %}
  Renders a notify me form for a product variant.

  @param {product} current_product - Current product object (required)
  @param {variant} current_variant - Current variant object (required)

  @example
  {% render 'notify-me', current_product: product, current_variant: current_variant %}
{% enddoc %}

{% liquid
  assign available = current_variant.available
%}

<div class="product__notify-me {% if available %}hide{% endif %}">
  {% form 'contact', class: 'product__notify-me-form' %}
    <h3>{{ 'product.notify_me' | t }}</h3>
    <input
      type="hidden"
      name="contact[form_type]"
      value="{{ 'product.notify_me' | t }}"
    >
    <input
      type="hidden"
      name="contact[product_id]"
      id="notify-me-product-id"
      value="{{ current_product.id }}"
    >
    <input
      type="hidden"
      name="contact[product_title]"
      id="notify-me-product-title"
      value="{{ current_product.title }}"
    >
    <input
      type="hidden"
      name="contact[variant_id]"
      id="notify-me-variant-id"
      value="{{ current_variant.id }}"
    >
    <input
      type="hidden"
      name="contact[variant_title]"
      id="notify-me-variant-title"
      value="{{ current_variant.title }}"
    >
    <input
      type="email"
      class="product__notify-me-email"
      name="contact[email]"
      id="notify-me-email"
      placeholder="{{ 'product.email' | t }}"
      value="{{ customer.email }}"
    >
    <input
      type="submit"
      class="product__notify-me-submit"
      id="notify-me-submit"
      value="{{ 'product.submit' | t }}"
    >
  {% endform %}
</div>

{% stylesheet %}
  .product__notify-me-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .product__notify-me-submit {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 400;
    color: #333;
    cursor: pointer;
  }
  .product__notify-me-submit:hover {
    background-color: #333;
    color: #fff;
  }
  .product__notify-me-email {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    font-weight: 400;
    color: #333;
  }
{% endstylesheet %}

{% javascript %}
  const NotifyMe = {
    init: function () {
      this.notifyMeForm = document.querySelector('.product__notify-me-form');
      this.notifyMeSubmit = document.querySelector('#notify-me-submit');
      this.notifyMeEmail = document.querySelector('#notify-me-email');

      this.notifyMeSubmit.addEventListener('click', (e) => {
        e.preventDefault();
        this.submitForm();
      });
    },

    submitForm: function () {
      if (!this.notifyMeEmail.value) {
        this.notifyMeEmail.classList.add('error');
        this.notifyMeEmail.focus();
        return;
      }
      this.notifyMeForm.submit();
    },
  };
  document.addEventListener('DOMContentLoaded', function () {
    NotifyMe.init();
  });
{% endjavascript %}
